(()=>{"use strict";var e={695:(e,r,t)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.createProgram=void 0;const o=t(722);r.createProgram=function(e,{vertex:r,fragment:t}){const i=(0,o.getShader)(e,r,e.VERTEX_SHADER),n=(0,o.getShader)(e,t,e.FRAGMENT_SHADER),a=e.createProgram();if(!a)throw new Error("createProgram failed");if(e.attachShader(a,i),e.attachShader(a,n),e.linkProgram(a),!e.getProgramParameter(a,e.LINK_STATUS))throw new Error("Unable to initialize the shader program.");return a}},694:(e,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.fragment=r.vertex=void 0,r.vertex="\nattribute vec3 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nvarying highp vec2 vTextureCoord;\n\nvoid main(void) {\n\tgl_Position = vec4(aVertexPosition, 1.0);\n\n\tvTextureCoord = aTextureCoord;\n}\n",r.fragment="\nprecision mediump float;\n\nvarying highp vec2 vTextureCoord;\n\nuniform sampler2D uImage;\nuniform mediump vec3 uDistortion;\nuniform mediump float uRatio;\n\nfloat computeScale(float distortion, float rsqLimit) {\n  if (distortion >= 0.0) {\n    return 1.0 + distortion * rsqLimit;\n  } else {\n    return 1.0 / (1.0 - distortion * rsqLimit);\n  }\n}\n\nvoid main(void) {\n\n  float rsq;\n  float rsqLimit;\n  if (uRatio < 1.0) {\n    rsq = pow((vTextureCoord.x - 0.5) * uRatio, 2.0) + pow(vTextureCoord.y - 0.5, 2.0);\n    rsqLimit = (pow(0.5 * uRatio, 2.0) + pow(0.5, 2.0)) / (2.0 / uRatio);\n  } else {\n    rsq = pow(vTextureCoord.x - 0.5, 2.0) + pow((vTextureCoord.y - 0.5) / uRatio, 2.0);\n    rsqLimit = (pow(0.5, 2.0) + pow(0.5 / uRatio, 2.0)) / (2.0 * uRatio);\n  }\n\n  vec3 scale = vec3(computeScale(uDistortion.r, rsqLimit),\n            computeScale(uDistortion.g, rsqLimit),\n            computeScale(uDistortion.b, rsqLimit));\n\n  gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n\n  vec2 redCoord = vec2(0.5 + (vTextureCoord.x - 0.5) * (1.0 + uDistortion.r * rsq) / scale.r,\n              0.5 + (vTextureCoord.y - 0.5) * (1.0 + uDistortion.r * rsq) / scale.r);\n\n  if (redCoord.x >= 0.0 && redCoord.x <= 1.0 && redCoord.y >= 0.0 && redCoord.y <= 1.0) {\n    gl_FragColor.r = texture2D(uImage, redCoord).r;\n    gl_FragColor.a += texture2D(uImage, redCoord).a / 3.0;\n  }\n\n  vec2 greenCoord = vec2(0.5 + (vTextureCoord.x - 0.5) * (1.0 + uDistortion.g * rsq) / scale.g,\n                0.5 + (vTextureCoord.y - 0.5) * (1.0 + uDistortion.g * rsq) / scale.g);\n\n  if (greenCoord.x >= 0.0 && greenCoord.x <= 1.0 && greenCoord.y >= 0.0 && greenCoord.y <= 1.0) {\n    gl_FragColor.g = texture2D(uImage, greenCoord).g;\n    gl_FragColor.a += texture2D(uImage, greenCoord).a / 3.0;\n  }\n\n  vec2 blueCoord = vec2(0.5 + (vTextureCoord.x - 0.5) * (1.0 + uDistortion.b * rsq) / scale.b,\n              0.5 + (vTextureCoord.y - 0.5) * (1.0 + uDistortion.b * rsq) / scale.b);\n\n  if (blueCoord.x >= 0.0 && blueCoord.x <= 1.0 && blueCoord.y >= 0.0 && blueCoord.y <= 1.0) {\n    gl_FragColor.b = texture2D(uImage, blueCoord).b;\n    gl_FragColor.a += texture2D(uImage, blueCoord).a / 3.0;\n  }\n}\n"},722:(e,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.getShader=void 0,r.getShader=function(e,r,t){const o=e.createShader(t);if(!o)throw new Error("Unable to create shader.");if(e.shaderSource(o,r),e.compileShader(o),!e.getShaderParameter(o,e.COMPILE_STATUS))throw new Error("An error occurred compiling the shaders: "+e.getShaderInfoLog(o));return o}},849:(e,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.initBuffers=void 0,r.initBuffers=function(e){const r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,1,1,1,0,0,1,0]),e.STATIC_DRAW);const t=e.createBuffer();return e.bindBuffer(e.ARRAY_BUFFER,t),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0]),e.STATIC_DRAW),{rectVerticesTextureCoordBuffer:r,rectVerticesBuffer:t}}},827:(e,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.initTextures=void 0,r.initTextures=function(e){const r=e.createTexture();return e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),r}},481:(e,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.initWebGL=void 0,r.initWebGL=function(e){const r=e.getContext("webgl",{depth:!1,preserveDrawingBuffer:!0});if(!r)throw new Error("Unable to initialize WebGL. Your browser or machine may not support it.");return r}},519:function(e,r,t){var o=this&&this.__createBinding||(Object.create?function(e,r,t,o){void 0===o&&(o=t);var i=Object.getOwnPropertyDescriptor(r,t);i&&!("get"in i?!r.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return r[t]}}),Object.defineProperty(e,o,i)}:function(e,r,t,o){void 0===o&&(o=t),e[o]=r[t]}),i=this&&this.__setModuleDefault||(Object.create?function(e,r){Object.defineProperty(e,"default",{enumerable:!0,value:r})}:function(e,r){e.default=r}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)"default"!==t&&Object.prototype.hasOwnProperty.call(e,t)&&o(r,e,t);return i(r,e),r};Object.defineProperty(r,"__esModule",{value:!0}),r.Fisheye=void 0;const a=t(695),s=n(t(694)),u=t(849),l=t(827),g=t(481);r.Fisheye=class{constructor(e){this.gl=(0,g.initWebGL)(e),this.gl.enable(this.gl.BLEND),this.gl.disable(this.gl.DEPTH_TEST),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.program=(0,a.createProgram)(this.gl,s),this.uDistortion=this.gl.getUniformLocation(this.program,"uDistortion"),this.uRatio=this.gl.getUniformLocation(this.program,"uRatio"),this.uImage=this.gl.getUniformLocation(this.program,"uImage"),this.aVertexPosition=this.gl.getAttribLocation(this.program,"aVertexPosition"),this.gl.enableVertexAttribArray(this.aVertexPosition),this.aTextureCoord=this.gl.getAttribLocation(this.program,"aTextureCoord"),this.gl.enableVertexAttribArray(this.aTextureCoord);const{rectVerticesTextureCoordBuffer:r,rectVerticesBuffer:t}=(0,u.initBuffers)(this.gl);this.rectVerticesTextureCoordBuffer=r,this.rectVerticesBuffer=t,this.imageTexture=(0,l.initTextures)(this.gl),this.setDistortion(0,0,0)}setDistortion(e=0,r=e,t=e){this.gl.useProgram(this.program),this.gl.uniform3fv(this.uDistortion,[e,r,t])}draw(e){this.gl.useProgram(this.program),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.rectVerticesBuffer),this.gl.vertexAttribPointer(this.aVertexPosition,3,this.gl.FLOAT,!1,0,0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.rectVerticesTextureCoordBuffer),this.gl.vertexAttribPointer(this.aTextureCoord,2,this.gl.FLOAT,!1,0,0),e.naturalWidth>0&&e.naturalHeight>0?this.gl.uniform1f(this.uRatio,e.naturalWidth/e.naturalHeight):e.width>0&&e.height>0?this.gl.uniform1f(this.uRatio,e.width/e.height):this.gl.uniform1f(this.uRatio,1),this.gl.uniform1i(this.uImage,0),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.imageTexture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4)}setViewport(e,r){this.gl.viewport(0,0,e,r)}clear(){this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT)}}}},r={},t=function t(o){var i=r[o];if(void 0!==i)return i.exports;var n=r[o]={exports:{}};return e[o].call(n.exports,n,n.exports,t),n.exports}(519),o=window;for(var i in t)o[i]=t[i];t.__esModule&&Object.defineProperty(o,"__esModule",{value:!0})})();