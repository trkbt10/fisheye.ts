(()=>{"use strict";var e={384:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,i)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&o(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Fisheye=void 0;const a=r(695),s=n(r(694)),u=r(849),l=r(827),g=r(481);t.Fisheye=class{constructor(e){this.gl=(0,g.initWebGL)(e),this.gl.enable(this.gl.BLEND),this.gl.disable(this.gl.DEPTH_TEST),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.program=(0,a.createProgram)(this.gl,s),this.uDistortion=this.gl.getUniformLocation(this.program,"uDistortion"),this.uRatio=this.gl.getUniformLocation(this.program,"uRatio"),this.uImage=this.gl.getUniformLocation(this.program,"uImage"),this.aVertexPosition=this.gl.getAttribLocation(this.program,"aVertexPosition"),this.gl.enableVertexAttribArray(this.aVertexPosition),this.aTextureCoord=this.gl.getAttribLocation(this.program,"aTextureCoord"),this.gl.enableVertexAttribArray(this.aTextureCoord);const{rectVerticesTextureCoordBuffer:t,rectVerticesBuffer:r}=(0,u.initBuffers)(this.gl);this.rectVerticesTextureCoordBuffer=t,this.rectVerticesBuffer=r,this.imageTexture=(0,l.initTextures)(this.gl),this.setDistortion(0,0,0)}setDistortion(e=0,t=e,r=e){this.gl.useProgram(this.program),this.gl.uniform3fv(this.uDistortion,[e,t,r])}draw(e){this.gl.useProgram(this.program),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.rectVerticesBuffer),this.gl.vertexAttribPointer(this.aVertexPosition,3,this.gl.FLOAT,!1,0,0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.rectVerticesTextureCoordBuffer),this.gl.vertexAttribPointer(this.aTextureCoord,2,this.gl.FLOAT,!1,0,0),e.naturalWidth>0&&e.naturalHeight>0?this.gl.uniform1f(this.uRatio,e.naturalWidth/e.naturalHeight):e.width>0&&e.height>0?this.gl.uniform1f(this.uRatio,e.width/e.height):this.gl.uniform1f(this.uRatio,1),this.gl.uniform1i(this.uImage,0),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.imageTexture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4)}setViewport(e,t){this.gl.viewport(0,0,e,t)}clear(){this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT)}}},695:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createProgram=void 0;const o=r(722);t.createProgram=function(e,{vertex:t,fragment:r}){const i=(0,o.getShader)(e,t,e.VERTEX_SHADER),n=(0,o.getShader)(e,r,e.FRAGMENT_SHADER),a=e.createProgram();if(!a)throw new Error("createProgram failed");if(e.attachShader(a,i),e.attachShader(a,n),e.linkProgram(a),!e.getProgramParameter(a,e.LINK_STATUS))throw new Error("Unable to initialize the shader program.");return a}},694:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.fragment=t.vertex=void 0,t.vertex="\nattribute vec3 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nvarying highp vec2 vTextureCoord;\n\nvoid main(void) {\n\tgl_Position = vec4(aVertexPosition, 1.0);\n\n\tvTextureCoord = aTextureCoord;\n}\n",t.fragment="\nprecision mediump float;\n\nvarying highp vec2 vTextureCoord;\n\nuniform sampler2D uImage;\nuniform mediump vec3 uDistortion;\nuniform mediump float uRatio;\n\nfloat computeScale(float distortion, float rsqLimit) {\n  if (distortion >= 0.0) {\n    return 1.0 + distortion * rsqLimit;\n  } else {\n    return 1.0 / (1.0 - distortion * rsqLimit);\n  }\n}\n\nvoid main(void) {\n\n  float rsq;\n  float rsqLimit;\n  if (uRatio < 1.0) {\n    rsq = pow((vTextureCoord.x - 0.5) * uRatio, 2.0) + pow(vTextureCoord.y - 0.5, 2.0);\n    rsqLimit = (pow(0.5 * uRatio, 2.0) + pow(0.5, 2.0)) / (2.0 / uRatio);\n  } else {\n    rsq = pow(vTextureCoord.x - 0.5, 2.0) + pow((vTextureCoord.y - 0.5) / uRatio, 2.0);\n    rsqLimit = (pow(0.5, 2.0) + pow(0.5 / uRatio, 2.0)) / (2.0 * uRatio);\n  }\n\n  vec3 scale = vec3(computeScale(uDistortion.r, rsqLimit),\n            computeScale(uDistortion.g, rsqLimit),\n            computeScale(uDistortion.b, rsqLimit));\n\n  gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n\n  vec2 redCoord = vec2(0.5 + (vTextureCoord.x - 0.5) * (1.0 + uDistortion.r * rsq) / scale.r,\n              0.5 + (vTextureCoord.y - 0.5) * (1.0 + uDistortion.r * rsq) / scale.r);\n\n  if (redCoord.x >= 0.0 && redCoord.x <= 1.0 && redCoord.y >= 0.0 && redCoord.y <= 1.0) {\n    gl_FragColor.r = texture2D(uImage, redCoord).r;\n    gl_FragColor.a += texture2D(uImage, redCoord).a / 3.0;\n  }\n\n  vec2 greenCoord = vec2(0.5 + (vTextureCoord.x - 0.5) * (1.0 + uDistortion.g * rsq) / scale.g,\n                0.5 + (vTextureCoord.y - 0.5) * (1.0 + uDistortion.g * rsq) / scale.g);\n\n  if (greenCoord.x >= 0.0 && greenCoord.x <= 1.0 && greenCoord.y >= 0.0 && greenCoord.y <= 1.0) {\n    gl_FragColor.g = texture2D(uImage, greenCoord).g;\n    gl_FragColor.a += texture2D(uImage, greenCoord).a / 3.0;\n  }\n\n  vec2 blueCoord = vec2(0.5 + (vTextureCoord.x - 0.5) * (1.0 + uDistortion.b * rsq) / scale.b,\n              0.5 + (vTextureCoord.y - 0.5) * (1.0 + uDistortion.b * rsq) / scale.b);\n\n  if (blueCoord.x >= 0.0 && blueCoord.x <= 1.0 && blueCoord.y >= 0.0 && blueCoord.y <= 1.0) {\n    gl_FragColor.b = texture2D(uImage, blueCoord).b;\n    gl_FragColor.a += texture2D(uImage, blueCoord).a / 3.0;\n  }\n}\n"},722:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getShader=void 0,t.getShader=function(e,t,r){const o=e.createShader(r);if(!o)throw new Error("Unable to create shader.");if(e.shaderSource(o,t),e.compileShader(o),!e.getShaderParameter(o,e.COMPILE_STATUS))throw new Error("An error occurred compiling the shaders: "+e.getShaderInfoLog(o));return o}},849:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.initBuffers=void 0,t.initBuffers=function(e){const t=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,t),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,1,1,1,0,0,1,0]),e.STATIC_DRAW);const r=e.createBuffer();return e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0]),e.STATIC_DRAW),{rectVerticesTextureCoordBuffer:t,rectVerticesBuffer:r}}},827:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.initTextures=void 0,t.initTextures=function(e){const t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),t}},481:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.initWebGL=void 0,t.initWebGL=function(e){const t=e.getContext("webgl",{depth:!1,preserveDrawingBuffer:!0});if(!t)throw new Error("Unable to initialize WebGL. Your browser or machine may not support it.");return t}}},t={},r=function r(o){var i=t[o];if(void 0!==i)return i.exports;var n=t[o]={exports:{}};return e[o].call(n.exports,n,n.exports,r),n.exports}(384);module.exports=r})();